<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>proland: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1></h1> 
<div class="mainpage">
<br/><h1>Proland Documentation - Edit Plugin</h1>
<h2><a class="anchor" id="sec-intro">
Introduction</a></h2>
<p>The Proland edit plugin provides extended terrain and graph producers allowing the real-time edition of their data. <em>This plugin requires the terrain, graph and river plugins at compile time, but only those actually used are needed at runtime (e.g. if you only use the extended terrain plugin producers, then you don't need the graph and river plugins to use this plugin).</em></p>
<h2><a class="anchor" id="sec-edit">
Terrain edition</a></h2>
<p>Terrain edition capabilities are provided via elevation and ortho producer subclasses to edit elevation and ortho maps, and via a dedicated layer to edit graphs. They allow the interactive edition of the terrain shape, of any terrain map (color map, tree density map, etc), and of terrain graphs. Then, any data that depend on edited data (such as terrain normals) is automatically recomputed via the producer framework, based on the Ork task scheduling framework. The "edit1", "edit2", "edit3", and "edit4" examples illustrate these terrain edition features.</p>
<h3><a class="anchor" id="sec-edit-dem">
Edit Elevation producer</a></h3>
<p>Terrain elevations can be edited by using the <a class="el" href="classproland_1_1EditResidualProducer.html" title="A ResidualProducer whose tiles can be edited at runtime.">proland::EditResidualProducer</a> and <a class="el" href="classproland_1_1EditElevationProducer.html" title="An ElevationProducer whose tiles can be edited at runtime.">proland::EditElevationProducer</a> classes together, instead of the proland::ResidualProducer and proland::ElevationProducer classes.</p>
<p>The <a class="el" href="classproland_1_1EditResidualProducer.html" title="A ResidualProducer whose tiles can be edited at runtime.">proland::EditResidualProducer</a> is a subclass of proland::ResidualProducer that stores in memory a set of modified tiles. When asked to produce a tile, this producer first look in the previous set to see if a modified version of this tile is available in memory. If so it simply returns this tile. Otherwise it delegates the tile production to its super class, which will load the tile from disk.</p>
<p>The <a class="el" href="classproland_1_1EditResidualProducer.html#a63c753210e53c34be15f2fa55fffb1c4" title="Notifies this producer that a tile has been edited.">proland::EditResidualProducer::editedTile</a> method is used to notify this producer that a new version of a tile is available. This method takes as parameter logical tile coordinates, as well as the <em>difference</em> between the current and the new version of the tile. When all modified tiles have been notified with this method, the <a class="el" href="classproland_1_1EditResidualProducer.html#aa2a4b4d64c7c820a17ca6253b60e2d71" title="Updates the residual tiles produced by this producer to take into account all the...">proland::EditResidualProducer::updateResiduals</a> must be called to recompute the residual tiles at all levels in the quadtree, using the upsampling filter defined in sec-residual.</p>
<p>The <a class="el" href="classproland_1_1EditElevationProducer.html" title="An ElevationProducer whose tiles can be edited at runtime.">proland::EditElevationProducer</a> is a subclass of proland::ElevationProducer with two main additional methods: </p>
<ul>
<li>
the first one, <a class="el" href="classproland_1_1EditElevationProducer.html#aa0d76a9abe1af64b184a32b51cbc387b" title="Notifies this Editor that a new stroke has been added to the shape being painted...">proland::EditElevationProducer::edit</a>, takes as parameter a 2D path in local terrain physical coordinates, and draws this path in the fourth channel of the elevation tiles in the cache (this channel is supposed unused). It then blends this fourth channel into the third one (containing the modified elevations). </li>
<li>
the second method, <a class="el" href="classproland_1_1EditElevationProducer.html#ac601e96bec7bef612f1e2e6abf8e7f9f" title="Notifies this Editor that the user has finished painting a shape on the terrain.">proland::EditElevationProducer::update</a>, reads backs the modified tiles on CPU, computes the differences between the current and new elevations (i.e. between the first and third channels), sends them to the residual producer with <a class="el" href="classproland_1_1EditResidualProducer.html#a63c753210e53c34be15f2fa55fffb1c4" title="Notifies this producer that a tile has been edited.">proland::EditResidualProducer::editedTile</a>, and finally asks the residual producer to recompute the residuals with <a class="el" href="classproland_1_1EditResidualProducer.html#aa2a4b4d64c7c820a17ca6253b60e2d71" title="Updates the residual tiles produced by this producer to take into account all the...">proland::EditResidualProducer::updateResiduals</a>. </li>
</ul>
<dl class="note"><dt><b>Note:</b></dt><dd>the <a class="el" href="classproland_1_1EditElevationProducer.html" title="An ElevationProducer whose tiles can be edited at runtime.">proland::EditElevationProducer</a> can <b>not</b> have layers. Indeed, the modifications produced by any layer would be incorporated in the residual tiles at the first edition attempt, which is not a desired behavior. The workaround for this is to use two elevation producers: a first edit elevation producer, without layers, and a normal elevation producer, with a proland::TextureLayer to copy the tiles from the first producer, and other layers to modify these copied tiles (not the original ones).</dd></dl>
<p>The "edit1" example shows how <a class="el" href="classproland_1_1EditResidualProducer.html" title="A ResidualProducer whose tiles can be edited at runtime.">proland::EditResidualProducer</a> and <a class="el" href="classproland_1_1EditElevationProducer.html" title="An ElevationProducer whose tiles can be edited at runtime.">proland::EditElevationProducer</a> can be used.</p>
<h3><a class="anchor" id="sec-edit-ortho">
Edit Ortho producer</a></h3>
<p>Terrain maps (color map, density map, etc) can be edited by using the <a class="el" href="classproland_1_1EditOrthoCPUProducer.html" title="An OrthoCPUProducer whose tiles can be edited at runtime.">proland::EditOrthoCPUProducer</a> and <a class="el" href="classproland_1_1EditOrthoProducer.html" title="An OrthoProducer whose tiles can be edited at runtime.">proland::EditOrthoProducer</a> classes together, instead of the proland::OrthoCPUProducer and proland::OrthoProducer classes.</p>
<p>The <a class="el" href="classproland_1_1EditOrthoCPUProducer.html" title="An OrthoCPUProducer whose tiles can be edited at runtime.">proland::EditOrthoCPUProducer</a> is a subclass of proland::OrthoCPUProducer that stores in memory a set of modified tiles. When asked to produce a tile, this producer first look in the previous set to see if a modified version of this tile is available in memory. If so it simply returns this tile. Otherwise it delegates the tile production to its super class, which will load the tile from disk.</p>
<p>The <a class="el" href="classproland_1_1EditOrthoCPUProducer.html#a549e4be21a290d142cbe9bbcfb6c3ac3" title="Notifies this producer that a tile has been edited.">proland::EditOrthoCPUProducer::editedTile</a> method is used to notify this producer that a new version of a tile is available. This method takes as parameter logical tile coordinates, as well as the <em>difference</em> between the current and the new version of the tile. When all modified tiles have been notified with this method, the proland::EditOrthoCPUProducer::updateResiduals must be called to recompute the residual tiles at all levels in the quadtree, using the upsampling filter defined in sec-ortho.</p>
<p>The <a class="el" href="classproland_1_1EditOrthoProducer.html" title="An OrthoProducer whose tiles can be edited at runtime.">proland::EditOrthoProducer</a> is a subclass of proland::OrthoProducer with two main additional methods: </p>
<ul>
<li>
the first one, <a class="el" href="classproland_1_1EditElevationProducer.html#aa0d76a9abe1af64b184a32b51cbc387b" title="Notifies this Editor that a new stroke has been added to the shape being painted...">proland::EditElevationProducer::edit</a>, takes as parameter a 2D path in local terrain physical coordinates, and draws this path (with some blending) in the ortho tiles in the cache (before that it reads these tiles back on CPU, in order to be able to compute color differences later on). </li>
<li>
the second method, <a class="el" href="classproland_1_1EditOrthoProducer.html#ad86e4339c355efce31be303a39a69c53" title="Notifies this Editor that the user has finished painting a shape on the terrain.">proland::EditOrthoProducer::update</a>, reads backs the modified tiles on CPU, computes the differences between the current and new colors (using the copy made before edition - see above), sends them to the residual producer with <a class="el" href="classproland_1_1EditOrthoCPUProducer.html#a549e4be21a290d142cbe9bbcfb6c3ac3" title="Notifies this producer that a tile has been edited.">proland::EditOrthoCPUProducer::editedTile</a>, and finally asks the residual producer to recompute the residuals with proland::EditOrthoCPUProducer::updateResiduals. </li>
</ul>
<dl class="note"><dt><b>Note:</b></dt><dd>the <a class="el" href="classproland_1_1EditOrthoProducer.html" title="An OrthoProducer whose tiles can be edited at runtime.">proland::EditOrthoProducer</a> can <b>not</b> have layers. Indeed, the modifications produced by any layer would be incorporated in the residual tiles at the first edition attempt, which is not a desired behavior. The workaround for this is to use two ortho producers: a first edit ortho producer, without layers, and a normal ortho producer, with a proland::TextureLayer to copy the tiles from the first producer, and other layers to modify these copied tiles (not the original ones).</dd></dl>
<p>The "edit2" example shows how <a class="el" href="classproland_1_1EditOrthoCPUProducer.html" title="An OrthoCPUProducer whose tiles can be edited at runtime.">proland::EditOrthoCPUProducer</a> and <a class="el" href="classproland_1_1EditOrthoProducer.html" title="An OrthoProducer whose tiles can be edited at runtime.">proland::EditOrthoProducer</a> can be used.</p>
<h3><a class="anchor" id="sec-edit-graph">
Edit Graph Ortho layer</a></h3>
<p>The <a class="el" href="classproland_1_1EditGraphOrthoLayer.html">EditGraphOrthoLayer </a> class is a <a class="el" href="">TileLayer</a> that draws the control points of an unflattened Graph on tiles produced by an <a class="el" href="">OrthoGPUProducer </a>, and allows the user to edit it interactively. Changes will then be propagated to the GraphListeners that share the same root Graph via the <a class="el" href="">notifyListeners()</a> method. <a class="el" href="classproland_1_1EditGraphOrthoLayer.html">EditGraphOrthoLayer </a> class uses Graph Tiles produced by a <a class="el" href="">GraphProducer </a>. It contains a vector of GraphProducers, so it can switch between them via the <a class="el" href="classproland_1_1EditGraphOrthoLayer.html#af8e1a7e7eeaec81dc1d28f0a5fb56cc4">setEditedGraph() </a> method, and then display and edit different Graphs corresponding to each of these GraphProducers.</p>
<p>This class also provides the functions to edit the Graph. You can :</p>
<ul>
<li><a class="el" href="classproland_1_1EditGraphOrthoLayer.html#ac52aec7a613370725b695e844e8d8036">Select</a> a point or a segment of a Curve. This point/segment will then be used for edition functions, until you select another point.</li>
<li><a class="el" href="classproland_1_1EditGraphOrthoLayer.html#af228f08a25cfdbf7839a9a16253ebd49">Move</a> a point.</li>
<li><a class="el" href="classproland_1_1EditGraphOrthoLayer.html#af28785a100bb0480f4b12d9e68feb96f">Add</a> a Curve (From 0, 1 or 2 existing Nodes).</li>
<li><a class="el" href="classproland_1_1EditGraphOrthoLayer.html#a1e5258ed9594ea0010b7cca5f63db776">Split</a> a Curve / <a class="el" href="classproland_1_1EditGraphOrthoLayer.html#a3c86870178dbfd8ffd1199bbf123b1a6">Merge</a> 2 Curves.</li>
<li><a class="el" href="classproland_1_1EditGraphOrthoLayer.html#ab2532b252547f63e05a967fbc7a462c5">Remove</a> a Curve.</li>
<li><a class="el" href="">Add</a> or <a class="el" href="">remove</a> a point from a Curve.</li>
<li><a class="el" href="classproland_1_1EditGraphOrthoLayer.html#a3c86870178dbfd8ffd1199bbf123b1a6">Remove</a> a point linking several Curves.</li>
<li><a class="el" href="">Transform</a> a ControlPoint.</li>
<li><a class="el" href="classproland_1_1EditGraphOrthoLayer.html#ae63867efeb3334b76b2442d92a47a1d7">Create</a> a smoothed curved by pressing SHIFT while moving the mouse.</li>
<li>Smooth a point by selecting it and pressing CTRL while moving the move.</li>
</ul>
<p>An EditGraphOrthoLayer can be loaded with the Ork resource framework, using the following format: </p>
<div class="fragment"><pre class="fragment">
&lt;editGraphLayer name="myEditGraphLayer"
   graphs="myFirstGraphProducer,anotherGraphProducer,yetAnotherGraphProducer"
   level = "3" softEdition="true" softEditionDelay="0.1"/&gt;
</pre></div><p>The <code>graphs</code> attribute must contain the names of the different GraphProducers that we want to be managed by this EditGraphOrthoLayer. In this example, 3 GraphProducers will be used. The <code>level</code> attribute represents the first level at which the Layer will start being displayed. Finally, a <code>softEdition</code> mode can be enabled. It allows to only update the graph when releasing the mouse. If set to false, the graph will be updated every <code>softEditionDelay</code> seconds.</p>
<p>The "edit3" example shows how <a class="el" href="classproland_1_1EditGraphOrthoLayer.html" title="An OrthoGPUProducer layer to edit Graph objects.">proland::EditGraphOrthoLayer</a> can be used.</p>
<h3><a class="anchor" id="sec-edit-hydrograph">
Edit HydroGraph Ortho layer</a></h3>
<p>This editor is just the same as the previous one, but adds a few functionnalities related to HydroGraphs.</p>
<ul>
<li>Change the potential of a curve.</li>
<li>Link a bank and its river axis.</li>
<li>Dynamically and automatically link newly created banks to nearest river axis. If the result is not satisfying for the user, there is always the possibility to manually edit the result afterwards.</li>
</ul>
<p>The "edit4" example shows how <a class="el" href="classproland_1_1EditHydroGraphOrthoLayer.html" title="An OrthoGPUProducer layer to edit Graph objects.">proland::EditHydroGraphOrthoLayer</a> can be used. </p>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Sat May 12 09:43:13 2012 for proland by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
