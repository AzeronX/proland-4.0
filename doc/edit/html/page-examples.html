<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>proland: Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="page-examples">Examples </a></h1> 
<div class="mainpage">
<p>The following examples show how the Proland edit plugin tasks and producers can be used. Since each example builds upon the previous ones, you should read them in order.</p>
<ul>
<li>
<a class="el" href="page-examples.html#sec-edit1">Edit1 example</a> </li>
<li>
<a class="el" href="page-examples.html#sec-edit2">Edit2 example</a> </li>
<li>
<a class="el" href="page-examples.html#sec-edit3">Edit3 example</a> </li>
<li>
<a class="el" href="page-examples.html#sec-edit4">Edit4 example</a> </li>
</ul>
<h2><a class="anchor" id="sec-edit1">
Edit1 example</a></h2>
 
<img src="edit1.png"><br/>
 <!--  <div align="center">
<img src="edit1.png" alt="edit1.png"/>
</div>
  --> <p>This example is based on the "terrain3" example from the terrain plugin, with two modifications: first the elevation producer is replaced with an edit elevation producer, allowing dynamic terrain shape modifications, and second the main window class is converted to an Ork resource, for greater flexibility.</p>
<p>To edit the terrain, click or drag the mouse while holding the SHIFT key pressed. You can also change the brush radius with the mouse wheel, while holding the SHIFT key pressed. See also the tweak bar to configure the edition tool. Press "e" to enable and disable terrain edition.</p>
<h3><a class="anchor" id="sec-terrain5-editdem">
Dynamic terrain edition</a></h3>
<p>In order to allow dynamic terrain edition, the default elevation producer must be replaced with a <a class="el" href="classproland_1_1EditElevationProducer.html" title="An ElevationProducer whose tiles can be edited at runtime.">proland::EditElevationProducer</a>. This producer requires an associated residual producer (unlike the default elevation producer; also it cannot have layers). So we first start by defining a residual producer (here without any associated file, which means that we will start with a completely flat terrain):</p>
 <div class="fragment"><pre class="fragment">    &lt;tileCache name=<span class="stringliteral">&quot;groundResiduals&quot;</span> scheduler=<span class="stringliteral">&quot;defaultScheduler&quot;</span>&gt;
        &lt;cpuFloatTileStorage tileSize=<span class="stringliteral">&quot;197&quot;</span> channels=<span class="stringliteral">&quot;1&quot;</span> capacity=<span class="stringliteral">&quot;1024&quot;</span>/&gt;
    &lt;/tileCache&gt;
    &lt;editResidualProducer name=<span class="stringliteral">&quot;groundResiduals1&quot;</span> cache=<span class="stringliteral">&quot;groundResiduals&quot;</span>/&gt;
</pre></div></p>
<p>We can then use this residual producer to define our edit elevation producer:</p>
 <div class="fragment"><pre class="fragment">    &lt;editElevationProducer name=<span class="stringliteral">&quot;groundElevations1&quot;</span> cache=<span class="stringliteral">&quot;groundElevations&quot;</span>
        residuals=<span class="stringliteral">&quot;groundResiduals1&quot;</span> terrain=<span class="stringliteral">&quot;terrainNode&quot;</span>
        edit=<span class="stringliteral">&quot;terrainShader&quot;</span> brush=<span class="stringliteral">&quot;brushShader;&quot;</span>/&gt;
</pre></div></p>
<p>Here we need to specify the scene node using this producer, in the "terrain" attribute, as well as the shader used to render the terrain, in the "edit" shader (this shader will be responsible to draw the edition brush on the terrain), and the shader defining how brush strokes modify the terrain elevations, in the "brush" attribute.</p>
<p>Note that, in order to specify the terrain scene node, this scene node must be a valid resource, identified by its name. In the "terrain3" example this terrain node is declared directly as a subnode of the scene graph node, and so cannot be loaded separately from the whole scene. In order to solve this problem we move its definition outside the definition of the scene graph node, and we then simply reference it:</p>
 <div class="fragment"><pre class="fragment">    &lt;node name=<span class="stringliteral">&quot;terrainNode&quot;</span> flags=<span class="stringliteral">&quot;object,dynamic&quot;</span>&gt;
        &lt;bounds xmin=<span class="stringliteral">&quot;-50000&quot;</span> xmax=<span class="stringliteral">&quot;50000&quot;</span> ymin=<span class="stringliteral">&quot;-50000&quot;</span> ymax=<span class="stringliteral">&quot;50000&quot;</span> zmin=<span class="stringliteral">&quot;0&quot;</span> zmax=<span class="stringliteral">&quot;5000&quot;</span>/&gt;
        &lt;field <span class="keywordtype">id</span>=<span class="stringliteral">&quot;terrain&quot;</span> value=<span class="stringliteral">&quot;terrain&quot;</span>/&gt;
        &lt;tileSamplerZ <span class="keywordtype">id</span>=<span class="stringliteral">&quot;elevation&quot;</span> sampler=<span class="stringliteral">&quot;elevationSampler&quot;</span> producer=<span class="stringliteral">&quot;groundElevations1&quot;</span> storeInvisible=<span class="stringliteral">&quot;false&quot;</span>/&gt;
        &lt;tileSampler <span class="keywordtype">id</span>=<span class="stringliteral">&quot;fnormal&quot;</span> sampler=<span class="stringliteral">&quot;fragmentNormalSampler&quot;</span> producer=<span class="stringliteral">&quot;groundNormals1&quot;</span> storeParent=<span class="stringliteral">&quot;false&quot;</span> storeInvisible=<span class="stringliteral">&quot;false&quot;</span>/&gt;
        &lt;mesh <span class="keywordtype">id</span>=<span class="stringliteral">&quot;grid&quot;</span> value=<span class="stringliteral">&quot;quad.mesh&quot;</span>/&gt;
        &lt;method <span class="keywordtype">id</span>=<span class="stringliteral">&quot;update&quot;</span> value=<span class="stringliteral">&quot;updateTerrainMethod&quot;</span>/&gt;
        &lt;method <span class="keywordtype">id</span>=<span class="stringliteral">&quot;draw&quot;</span> value=<span class="stringliteral">&quot;drawTerrainMethod&quot;</span>/&gt;
        &lt;module <span class="keywordtype">id</span>=<span class="stringliteral">&quot;material&quot;</span> value=<span class="stringliteral">&quot;terrainShader&quot;</span>/&gt;
    &lt;/node&gt;

    &lt;node name=<span class="stringliteral">&quot;scene&quot;</span>&gt;
        &lt;node flags=<span class="stringliteral">&quot;camera&quot;</span>&gt;
            &lt;method <span class="keywordtype">id</span>=<span class="stringliteral">&quot;draw&quot;</span> value=<span class="stringliteral">&quot;cameraMethod&quot;</span>/&gt;
        &lt;/node&gt;

        &lt;node name=<span class="stringliteral">&quot;t&quot;</span> value=<span class="stringliteral">&quot;terrainNode&quot;</span>/&gt;
</pre></div></p>
<p>We finally add a tweak bar allowing the user to configure the terrain edition tool, and to reset the terrain to its original shape:</p>
 <div class="fragment"><pre class="fragment">    &lt;tweakDem name=<span class="stringliteral">&quot;editDem&quot;</span> active=<span class="stringliteral">&quot;true&quot;</span>/&gt;

    &lt;tweakScene name=<span class="stringliteral">&quot;editScene&quot;</span> scene=<span class="stringliteral">&quot;scene&quot;</span> active=<span class="stringliteral">&quot;false&quot;</span>/&gt;

    &lt;tweakBarManager name=<span class="stringliteral">&quot;tweakBar&quot;</span> next=<span class="stringliteral">&quot;viewHandler&quot;</span>&gt;
        &lt;editor <span class="keywordtype">id</span>=<span class="stringliteral">&quot;scene&quot;</span> bar=<span class="stringliteral">&quot;editScene&quot;</span> exclusive=<span class="stringliteral">&quot;false&quot;</span>/&gt;
        &lt;editor <span class="keywordtype">id</span>=<span class="stringliteral">&quot;dem&quot;</span> bar=<span class="stringliteral">&quot;editDem&quot;</span> key=<span class="stringliteral">&quot;e&quot;</span> exclusive=<span class="stringliteral">&quot;true&quot;</span>/&gt;
    &lt;/tweakBarManager&gt;
</pre></div></p>
<p>We set its active state to "true" so that it is active by default when the application starts. We also associate the shortcut key "e" to this tweak bar, in order to activate or deactivate it with this key. We finally specify that this tweak bar can not be active at the same time as another bar, with the "exclusive" flag.</p>
<p>The "brushShader.glsl" file defines how brush strokes modify the terrain elevations. This shader is given as input the positions and radiuses of the extremities of a stroke segment (it is executed once per segment), in "stroke" and "strokeEnd", as well as a brush "elevation", in "brushElevation". It must output an elevation at each point p in the alpha channel, which will then be blended with the current terrain elevations. In this particular implementation the output is computed based on the distance from p to the stroke segment, using a smoothstep function of this distance (but other choices are possible, you can modify this shader as you want).</p>
<p>The "initShader.glsl" and "composeShader.glsl" are shaders that are needed by the <a class="el" href="classproland_1_1EditElevationProducer.html" title="An ElevationProducer whose tiles can be edited at runtime.">proland::EditElevationProducer</a>, with these exact names. They are used to initialize a tile before drawing brush strokes in it ("initShader" must copy the current elevations from "initSampler" in the rgb channels, reset the blue channel to the red channel, and reset the alpha channel to 0), and to compose the current elevations with the brush strokes ("composeShader" must update the modified elevation in the blue channel by composing it with the brush elevation in the alpha channel - in this implementation the two are simply added, but you can change this if needed).</p>
<p>Finally the edition brush is displayed on the terrain with the following additional code in "terrainShader.glsl":</p>
 <div class="fragment"><pre class="fragment">    <span class="keywordflow">if</span> (length(p.xy - pencil.xy) &lt; pencil.w) {
        data += pencilColor;
    }
</pre></div></p>
<p>where "pencil" and "pencilColor" are uniforms set by the event handler associated with the terrain edition tweak bar (in the shader specified in the "edit" attribute of the edit elevation producer, here "terrainShader").</p>
<h3><a class="anchor" id="sec-terrain5-windowres">
Window resource</a></h3>
<p>In this example, for greater flexibility, the main window class is converted to an Ork resource. We can thus declare and configure it in the "helloworld.xml" archive file:</p>
 <div class="fragment"><pre class="fragment">    &lt;helloworld name=<span class="stringliteral">&quot;window&quot;</span> ui=<span class="stringliteral">&quot;tweakBar&quot;</span> view=<span class="stringliteral">&quot;viewHandler&quot;</span>/&gt;
</pre></div></p>
<p>where "viewHandler" is the proland::BasicViewHandler, now declared as an Ork resource as well:</p>
 <div class="fragment"><pre class="fragment">    &lt;basicViewHandler name=<span class="stringliteral">&quot;viewHandler&quot;</span> viewManager=<span class="stringliteral">&quot;window&quot;</span>/&gt;
</pre></div></p>
<p>which allows us to also declare the link between the tweak bar manager event handler and the view event handler in the resources, with the "next" attribute (see sec-terrain3-ui):</p>
 <div class="fragment"><pre class="fragment">    &lt;tweakBarManager name=<span class="stringliteral">&quot;tweakBar&quot;</span> next=<span class="stringliteral">&quot;viewHandler&quot;</span>&gt;
</pre></div></p>
<p>Finally, to convert the HelloWorld C++ class into an Ork resource we mainly need to move the code in the HelloWorld constructor to the main function (because the constructor will now be called by the Ork resource loading mechanism, which must therefore be initialized before that) and to the constructor of a subclass, inheriting from ork::Resource, and defined as follows:</p>
 <div class="fragment"><pre class="fragment"><span class="keyword">class </span>HelloWorldResource : <span class="keyword">public</span> ResourceTemplate&lt;100, HelloWorld&gt;
{
<span class="keyword">public</span>:
    HelloWorldResource(ptr&lt;ResourceManager&gt; manager, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name, ptr&lt;ResourceDescriptor&gt; desc, <span class="keyword">const</span> TiXmlElement *e = NULL) :
        ResourceTemplate&lt;100, HelloWorld&gt; (manager, name, desc)
    {
        e = e == NULL ? desc-&gt;descriptor : e;
        checkParameters(desc, e, <span class="stringliteral">&quot;name,ui,view,radius,&quot;</span>);

        scene = <span class="keyword">new</span> SceneManager();
        scene-&gt;setResourceManager(manager);
        scene-&gt;setScheduler(manager-&gt;loadResource(<span class="stringliteral">&quot;defaultScheduler&quot;</span>).cast&lt;Scheduler&gt;());
        scene-&gt;setRoot(manager-&gt;loadResource(<span class="stringliteral">&quot;scene&quot;</span>).cast&lt;SceneNode&gt;());
        scene-&gt;setCameraNode(<span class="stringliteral">&quot;camera&quot;</span>);
        scene-&gt;setCameraMethod(<span class="stringliteral">&quot;draw&quot;</span>);
        ui = manager-&gt;loadResource(getParameter(desc, e, <span class="stringliteral">&quot;ui&quot;</span>)).cast&lt;EventHandler&gt;();
        view = manager-&gt;loadResource(getParameter(desc, e, <span class="stringliteral">&quot;view&quot;</span>)).cast&lt;BasicViewHandler&gt;();
        <span class="keywordflow">if</span> (e-&gt;Attribute(<span class="stringliteral">&quot;radius&quot;</span>) != NULL) {
            <span class="keywordtype">float</span> radius;
            getFloatParameter(desc, e, <span class="stringliteral">&quot;radius&quot;</span>, &amp;radius);
            controller = <span class="keyword">new</span> PlanetViewController(scene-&gt;getCameraNode(), radius);
        } <span class="keywordflow">else</span> {
            controller = <span class="keyword">new</span> TerrainViewController(scene-&gt;getCameraNode(), 50000.0);
        }
    }

    <span class="keyword">virtual</span> <span class="keywordtype">void</span> doRelease()
    {
        <span class="keywordflow">if</span> (manager != NULL) {
            manager-&gt;close();
        }
        <span class="keyword">delete</span> <span class="keyword">this</span>;
    }
};
</pre></div></p>
<p>ResourceTemplate is a C++ class template inheriting from ork::Resource and from the class specified as second template argument (the first argument is a priority to order resources during loading). Most of the code is in the constructor. This code checks that the XML attributes of the resource declaration are amongst "name", "ui", "view" and "radius". It then loads the "ui" and "view" resources to initialize the scene manager, in a similar way as in the original constructor of the "terrain3" example. A noticeable difference is that, depending on the value of "radius", a planet view controller or a "flat" view controller is instantiated.</p>
<p>The last step to be able to use this resource from an XML file is to declare the association between an XML tag name and the HelloWorldResource class. This is done as follows:</p>
 <div class="fragment"><pre class="fragment"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span> helloworld[] = <span class="stringliteral">&quot;helloworld&quot;</span>;

<span class="keyword">static</span> ResourceFactory::Type&lt;helloworld, HelloWorldResource&gt; HelloWorldType;
</pre></div></p>
<p>The result of these changes is that it is now possible to choose the user interface components, the view handler and the kind of terrain (flat or spherical) without needing to recompile the main C++ class, i.e., only by changing the "helloworld.xml" file.</p>
<h2><a class="anchor" id="sec-edit2">
Edit2 example</a></h2>
 
<img src="edit2.png"><br/>
 <!--  <div align="center">
<img src="edit2.png" alt="edit2.png"/>
</div>
  --> <p>This example is based on the "edit1" example, but with an ortho texture editor instead of an elevation editor (note: in this example we edit a texture which is directly used to render the terrain, but it is of course possible to edit any texture, like a tree density map for instance).</p>
<p>To edit the terrain texture, click or drag the mouse while holding the SHIFT key pressed. You can also change the brush radius with the mouse wheel, while holding the SHIFT key pressed. See also the tweak bar to configure the edition tool. Press "c" to enable and disable terrain texture edition.</p>
<p>In order to allow dynamic terrain texture edition, the default ortho producer must be replaced with a <a class="el" href="classproland_1_1EditOrthoProducer.html" title="An OrthoProducer whose tiles can be edited at runtime.">proland::EditOrthoProducer</a>. This producer requires an associated residual producer (unlike the default ortho producer; also it cannot have layers). So we first start by defining a residual producer (here without any associated file, which means that we will start with a completely black terrain):</p>
 <div class="fragment"><pre class="fragment">    &lt;tileCache name=<span class="stringliteral">&quot;groundOrthoCpu&quot;</span> scheduler=<span class="stringliteral">&quot;defaultScheduler&quot;</span>&gt;
        &lt;cpuByteTileStorage tileSize=<span class="stringliteral">&quot;196&quot;</span> channels=<span class="stringliteral">&quot;4&quot;</span> capacity=<span class="stringliteral">&quot;1024&quot;</span>/&gt;
    &lt;/tileCache&gt;
    &lt;editOrthoCpuProducer name=<span class="stringliteral">&quot;groundOrthoCpu1&quot;</span> cache=<span class="stringliteral">&quot;groundOrthoCpu&quot;</span>/&gt;
</pre></div></p>
<p>We can then use this residual producer to define our edit ortho producer:</p>
 <div class="fragment"><pre class="fragment">    &lt;editOrthoProducer name=<span class="stringliteral">&quot;groundOrthoGpu1&quot;</span> cache=<span class="stringliteral">&quot;groundOrthoGpu&quot;</span>
        residuals=<span class="stringliteral">&quot;groundOrthoCpu1&quot;</span> terrain=<span class="stringliteral">&quot;terrainNode&quot;</span>
        edit=<span class="stringliteral">&quot;terrainShader&quot;</span> brush=<span class="stringliteral">&quot;brushOrthoShader;&quot;</span>/&gt;
</pre></div></p>
<p>Here we need to specify the scene node using this producer, in the "terrain" attribute, as well as the shader used to render the terrain, in the "edit" shader (this shader will be responsible to draw the edition brush on the terrain), and the shader defining how brush strokes modify the terrain texture, in the "brush" attribute.</p>
<p>We finally add a tweak bar allowing the user to configure the terrain edition tool, and to reset the terrain texture to its original value:</p>
 <div class="fragment"><pre class="fragment">    &lt;tweakOrtho name=<span class="stringliteral">&quot;editOrtho&quot;</span> active=<span class="stringliteral">&quot;true&quot;</span>/&gt;

    &lt;tweakScene name=<span class="stringliteral">&quot;editScene&quot;</span> scene=<span class="stringliteral">&quot;scene&quot;</span> active=<span class="stringliteral">&quot;false&quot;</span>/&gt;

    &lt;tweakBarManager name=<span class="stringliteral">&quot;tweakBar&quot;</span> next=<span class="stringliteral">&quot;viewHandler&quot;</span>&gt;
        &lt;editor <span class="keywordtype">id</span>=<span class="stringliteral">&quot;scene&quot;</span> bar=<span class="stringliteral">&quot;editScene&quot;</span> exclusive=<span class="stringliteral">&quot;false&quot;</span>/&gt;
        &lt;editor <span class="keywordtype">id</span>=<span class="stringliteral">&quot;ortho&quot;</span> bar=<span class="stringliteral">&quot;editOrtho&quot;</span> key=<span class="stringliteral">&quot;c&quot;</span> exclusive=<span class="stringliteral">&quot;true&quot;</span>/&gt;
    &lt;/tweakBarManager&gt;
</pre></div></p>
<p>We set its active state to "true" so that it is active by default when the application starts. We also associate the shortcut key "c" to this tweak bar, in order to activate or deactivate it with this key. We finally specify that this tweak bar can not be active at the same time as another bar, with the "exclusive" flag.</p>
<p>The "brushShader.glsl" file defines how brush strokes modify the terrain texture. This shader is given as input the positions and radiuses of the extremities of a stroke segment (it is executed once per segment), in "stroke" and "strokeEnd". It must output an alpha value at each point p, which will be used to blend the brush color with the current texture values. In this particular implementation the output is computed based on the distance from p to the stroke segment, using a smoothstep function of this distance (but other choices are possible, you can modify this shader as you want).</p>
<p>The "initOrthoShader.glsl" and "composeOrthoShader.glsl" are shaders that are needed by the <a class="el" href="classproland_1_1EditOrthoProducer.html" title="An OrthoProducer whose tiles can be edited at runtime.">proland::EditOrthoProducer</a>, with these exact names. They are used to initialize a tile before drawing brush strokes in it ("initShader" must copy the current colors from "initSampler"), and to compose the current colors with the brush color ("composeShader" must compose the current colors in "sourceSampler" with the brush color in "brushColor", based on the alpha mask in "brushSampler" - in this implementation a simple alpha blending is done, but you can change this if needed).</p>
<p>Finally the edition brush is displayed on the terrain with the following additional code in "terrainShader.glsl":</p>
 <div class="fragment"><pre class="fragment">    <span class="keywordflow">if</span> (length(p.xy - pencil.xy) &lt; pencil.w) {
        data += pencilColor;
    }
</pre></div></p>
<p>where "pencil" and "pencilColor" are uniforms set by the event handler associated with the terrain edition tweak bar (in the shader specified in the "edit" attribute of the edit elevation producer, here "terrainShader").</p>
<h2><a class="anchor" id="sec-edit3">
Edit3 example</a></h2>
 
<img src="edit3.png"><br/>
 <!--  <div align="center">
<img src="edit3.png" alt="edit3.png"/>
</div>
  --> <p>This example adds interactive graph edition capabilities to the "graph1" example from the graph plugin (based on the paper "Real-time rendering and
editing of vector-based terrains", Eric Bruneton and Fabrice Neyret, Eurographics 2008). Press "e" to enable and disable this feature. When enabled, you can move the control points with the mouse, insert new control points at the current mouse position with the Insert key, delete the selected point or curve with the End key, etc. You can also right click on a control point or curve to perform various operations on them. Finally the tweak bar can be used to modify the width of the selected curve).</p>
<p>Enabling this feature is quite easy. We first add a <a class="el" href="classproland_1_1EditGraphOrthoLayer.html" title="An OrthoGPUProducer layer to edit Graph objects.">proland::EditGraphOrthoLayer</a> to the ortho GPU producer. This layer is responsible to draw the control points and curves when the edition mode is enabled (note that we removed the precomputed texture, replaced with an empty ortho layer; the "backgroundCache" attribute is thus no longer necessary):</p>
 <div class="fragment"><pre class="fragment">    &lt;orthoGpuProducer name=<span class="stringliteral">&quot;groundOrthoGpu1&quot;</span> cache=<span class="stringliteral">&quot;groundOrthoGpu&quot;</span>&gt;
        &lt;emptyOrthoLayer name=<span class="stringliteral">&quot;background&quot;</span> color=<span class="stringliteral">&quot;200,200,200&quot;</span>/&gt;
        &lt;roadOrthoLayer name=<span class="stringliteral">&quot;roadOrtho1&quot;</span> graph=<span class="stringliteral">&quot;roads&quot;</span>
            renderProg=<span class="stringliteral">&quot;roadLayerOrthoShader;&quot;</span> quality=<span class="stringliteral">&quot;true&quot;</span>/&gt;
        &lt;editGraphOrthoLayer name=<span class="stringliteral">&quot;editGraph1&quot;</span> graphs=<span class="stringliteral">&quot;roads&quot;</span> terrain=<span class="stringliteral">&quot;terrainNode&quot;</span>
            renderProg=<span class="stringliteral">&quot;editLayerShader;&quot;</span>/&gt;
    &lt;/orthoGpuProducer&gt;
</pre></div></p>
<p>Here we specify that this layer will be used to edit the "roads" graph (you can specify multiple graphs here, separated with commas), in the "terrainNode" scene node, and that the control points and curves will be rendered with the "editLayerShader" shader. This shader is really basic, it simply selects a color based on the vertex z coordinate, which encodes the type of this vertex (selected or not, curve node or curve control point, etc).</p>
<p>Finally we add a <a class="el" href="classproland_1_1TweakGraphLayer.html" title="A TweakBarHandler providing graph edition tools.">proland::TweakGraphLayer</a> tweak bar to control this layer, as follows:</p>
<p><div class="fragment"><pre class="fragment">    &lt;tweakGraphLayer name=<span class="stringliteral">&quot;editGraphs&quot;</span> active=<span class="stringliteral">&quot;true&quot;</span>/&gt;

    &lt;tweakBarManager name=<span class="stringliteral">&quot;ui&quot;</span>&gt;
        &lt;editor <span class="keywordtype">id</span>=<span class="stringliteral">&quot;scene&quot;</span> bar=<span class="stringliteral">&quot;editScene&quot;</span> exclusive=<span class="stringliteral">&quot;false&quot;</span>/&gt;
        &lt;editor <span class="keywordtype">id</span>=<span class="stringliteral">&quot;graphs&quot;</span> bar=<span class="stringliteral">&quot;editGraphs&quot;</span> exclusive=<span class="stringliteral">&quot;true&quot;</span>/&gt;
    &lt;/tweakBarManager&gt;
</pre></div></p>
<p>And that's it!</p>
<h2><a class="anchor" id="sec-edit4">
Edit4 example</a></h2>
 
<img src="edit4.png"><br/>
 <!--  <div align="center">
<img src="edit4.png" alt="edit4.png"/>
</div>
  --> <p>This example adds interactive graph edition capabilities to the "river1" example from the river plugin (press "e" to enable and disable this feature. When enabled, you can move the control points with the mouse, insert new control points at the current mouse position with the Insert key, delete the selected point or curve with the End key, etc. You can also right click on a control point or curve to perform various operations on them. Finally the tweak bar can be used to modify the width and type of the selected curve).</p>
<p>Enabling this feature is quite easy. We first add a <a class="el" href="classproland_1_1EditHydroGraphOrthoLayer.html" title="An OrthoGPUProducer layer to edit Graph objects.">proland::EditHydroGraphOrthoLayer</a> to the ortho GPU producer. This layer is responsible to draw the control points and curves when the edition mode is enabled:</p>
 <div class="fragment"><pre class="fragment">    &lt;orthoGpuProducer name=<span class="stringliteral">&quot;groundOrthoGpu1&quot;</span> cache=<span class="stringliteral">&quot;groundOrthoGpu&quot;</span>&gt;
        &lt;emptyOrthoLayer name=<span class="stringliteral">&quot;background&quot;</span> color=<span class="stringliteral">&quot;200,200,200&quot;</span>/&gt;
        &lt;editHydroGraphOrthoLayer name=<span class="stringliteral">&quot;editGraph1&quot;</span> graphs=<span class="stringliteral">&quot;rivers&quot;</span> terrain=<span class="stringliteral">&quot;terrainNode&quot;</span>
            renderProg=<span class="stringliteral">&quot;editLayerShader;&quot;</span>/&gt;
    &lt;/orthoGpuProducer&gt;
</pre></div></p>
<p>Here we specify that this layer will be used to edit the "water" graph (you can specify multiple graphs here, separated with commas), in the "terrainNode" scene node, and that the control points and curves will be rendered with the "editLayerShader" shader.</p>
<p>Finally we add a <a class="el" href="classproland_1_1TweakHydroGraphLayer.html" title="A TweakGraphLayer providing additional edition tools for hydro graphs.">proland::TweakHydroGraphLayer</a> tweak bar to control this layer, as follows (we also add a <a class="el" href="classproland_1_1TweakRivers.html" title="A TweakBarHandler to control rivers rendering and animation.">proland::TweakRivers</a> tweak bar to control the draw river task, but this is not necessary to simply edit the river graph):</p>
<p><div class="fragment"><pre class="fragment">    &lt;tweakHydroGraphLayer name=<span class="stringliteral">&quot;tweakGraphLayer1&quot;</span> active=<span class="stringliteral">&quot;true&quot;</span>/&gt;

    &lt;tweakRivers name=<span class="stringliteral">&quot;tweakRivers1&quot;</span> drawer=<span class="stringliteral">&quot;drawRiversMethod&quot;</span> active=<span class="stringliteral">&quot;true&quot;</span>/&gt;

    &lt;tweakBarManager name=<span class="stringliteral">&quot;ui&quot;</span>&gt;
        &lt;editor <span class="keywordtype">id</span>=<span class="stringliteral">&quot;scene&quot;</span> bar=<span class="stringliteral">&quot;editScene&quot;</span> exclusive=<span class="stringliteral">&quot;false&quot;</span>/&gt;
        &lt;editor <span class="keywordtype">id</span>=<span class="stringliteral">&quot;editor1&quot;</span> bar=<span class="stringliteral">&quot;tweakGraphLayer1&quot;</span> exclusive=<span class="stringliteral">&quot;true&quot;</span>/&gt;
        &lt;editor <span class="keywordtype">id</span>=<span class="stringliteral">&quot;editor2&quot;</span> bar=<span class="stringliteral">&quot;tweakRivers1&quot;</span> exclusive=<span class="stringliteral">&quot;false&quot;</span>/&gt;
    &lt;/tweakBarManager&gt;
</pre></div></p>
<p>And that's it! </p>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Sat May 12 09:43:14 2012 for proland by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
